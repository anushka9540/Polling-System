import { defineStore } from 'pinia';
import { ref } from 'vue';
import axios from 'axios';
import { BASE_URL } from '../constants/constant.js';

export const useSignupAuth = defineStore('signupAuth', () => {
  const loading = ref(false);

  const handleSignup = async (payload) => {
    loading.value = true;
  
    try {
      const response = await axios.post(`${BASE_URL}/user/register`, payload);
  
      localStorage.setItem('user', JSON.stringify(response.data?.user || {}));
  
      return {
        success: true,
        message: response?.data?.message || 'Registration successful!'
      };
    } catch (error) {
      const errorMessage =
        error.response?.data?.message || 'Signup failed!';
  
      if (
        errorMessage.includes('First name must be') ||
        errorMessage.includes('Last name must be')
      ) {
        return {
          success: false,
          message: errorMessage,
          fieldErrors: {
            firstName: errorMessage.includes('First name') ? errorMessage : '',
            lastName: errorMessage.includes('Last name') ? errorMessage : ''
          }
        };
      }
      if (errorMessage.includes('Duplicate entry')) {
        return {
          success: false,
          message: 'Email is already in use. Please try another.'
        };
      }
  
      return {
        success: false,
        message: errorMessage
      };
    }
  };
  
  return { handleSignup, loading };
});
