import { defineStore } from 'pinia';
import { ref } from 'vue';
import axios from 'axios';
import { BASE_URL } from '../constants/constant.js';

export const useSignupAuth = defineStore('signupAuth', () => {
  const loading = ref(false);

  const handleSignup = async (payload) => {
    loading.value = true;

    try {
      const response = await axios.post(`${BASE_URL}/user/register`, payload);

      return {
        success: true,
        message: response?.data?.message || 'Registration successful!'
      };
    } catch (error) {
      loading.value = false;

      if (error?.response?.status === 500) {
        return {
          success: false,
          message: 'Email is already in use',
          fieldErrors: {
            email: 'Email is already in use'
          }
        };
      }

      return {
        success: false,
        message:
          error?.response?.data?.message ||
          'Something went wrong. Sign up failed!'
      };
    }
  };

  return { handleSignup, loading };
});
